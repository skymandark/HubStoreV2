@model IEnumerable<Core.ViewModels.StockOutReturnViewModels.StockOutReturnListDto>
@{
    ViewData["Title"] = "صرف أوامر الإرجاع";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    :root {
        --glass-bg: rgba(255, 255, 255, 0.7);
        --glass-border: rgba(255, 255, 255, 0.2);
        --primary-gradient: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        --accent-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
    }

    .premium-header {
        background: var(--primary-gradient);
        border-radius: 16px;
        padding: 40px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .premium-header::after {
        content: '';
        position: absolute;
        top: -50px;
        left: -50px;
        width: 150px;
        height: 150px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 50%;
    }

    .premium-header h1 {
        color: white;
        font-weight: 800;
        margin: 0;
        letter-spacing: -1px;
    }

    .premium-header p {
        color: rgba(255, 255, 255, 0.7);
        margin-top: 10px;
        margin-bottom: 0;
        font-size: 1.1rem;
    }

    .grid-wrapper-elegant {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        border-radius: 16px;
        border: 1px solid var(--glass-border);
        padding: 24px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .btn-create-premium {
        background: var(--accent-gradient);
        color: white !important;
        border: none;
        padding: 12px 28px;
        border-radius: 12px;
        font-weight: 700;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.39);
    }

    .btn-create-premium:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.23);
    }

    .status-badge {
        padding: 6px 14px;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 700;
        text-transform: uppercase;
    }

    .status-draft { background: #f1f5f9; color: #475569; }
    .status-approved { background: #ecfdf5; color: #059669; }
    .status-executed { background: #eff6ff; color: #2563eb; }
    .status-rejected { background: #fef2f2; color: #dc2626; }

    /* DX Grid Overrides */
    .dx-datagrid { border-radius: 12px; overflow: hidden; }
    .dx-datagrid-headers { background: #f8fafc !important; }
    .dx-header-row { font-weight: 700; color: #1e293b; }
</style>

<div class="container-fluid py-4 animate__animated animate__fadeIn">
    <div class="premium-header animate__animated animate__slideInDown">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="fas fa-file-invoice-dollar me-3"></i>صرف أوامر الإرجاع</h1>
                <p>إدارة وتتبع عمليات صرف بضائع المرتجعات بسهولة ودقة</p>
            </div>
            <a href="@Url.Action("Save")" class="btn-create-premium">
                <i class="fas fa-plus-circle"></i> إنشاء صرف جديد
            </a>
        </div>
    </div>

    <div class="grid-wrapper-elegant animate__animated animate__fadeInUp animate__delay-1s">
        <div id="gridContainer"></div>
    </div>
</div>

@section Scripts {
    <script>
        $(function() {
            $("#gridContainer").dxDataGrid({
                dataSource: {
                    load: function() {
                        return $.getJSON("@Url.Action("ReadDx")");
                    }
                },
                rtlEnabled: true,
                showBorders: false,
                columnAutoWidth: true,
                rowAlternationEnabled: true,
                hoverStateEnabled: true,
                searchPanel: { visible: true, width: 280, placeholder: "بحث في الطلبات..." },
                paging: { pageSize: 12 },
                pager: { showPageSizeSelector: true, allowedPageSizes: [10, 20, 50], showInfo: true },
                columns: [
                    { 
                        dataField: "docCode", 
                        caption: "رقم السند", 
                        width: 160,
                        cellTemplate: function(container, options) {
                            $("<div class='fw-bold text-primary'>")
                                .append(options.value)
                                .appendTo(container);
                        }
                    },
                    { dataField: "docDate", caption: "التاريخ", dataType: "date", format: "yyyy/MM/dd", width: 140 },
                    { dataField: "clientName", caption: "العميل", minWidth: 200 },
                    { dataField: "branchName", caption: "الفرع", width: 150 },
                    { 
                        dataField: "netValue", 
                        caption: "صافي القيمة", 
                        dataType: "number", 
                        format: "#,##0.00",
                        width: 140,
                        cssClass: "fw-bold"
                    },
                    { 
                        dataField: "status", 
                        caption: "الحالة", 
                        width: 130,
                        cellTemplate: function(container, options) {
                            let cls = "status-draft", txt = "مسودة";
                            switch(options.value) {
                                case "1": cls = "status-approved"; txt = "معتمد"; break;
                                case "3": cls = "status-executed"; txt = "تم الصرف"; break;
                                case "4": cls = "status-rejected"; txt = "مرفوض"; break;
                            }
                            $("<span class='status-badge " + cls + "'>")
                                .append(txt)
                                .appendTo(container);
                        }
                    },
                    {
                        type: "buttons",
                        width: 110,
                        buttons: [{
                            hint: "تعديل",
                            icon: "edit",
                            onClick: function(e) {
                                window.location.href = "@Url.Action("Save")/" + e.row.data.stockOutReturnId;
                            }
                        }, {
                            hint: "حذف",
                            icon: "trash",
                            onClick: function(e) {
                                // Add delete confirmation
                            }
                        }]
                    }
                ]
            });
        });
    </script>
}