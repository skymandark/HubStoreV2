@model Core.ViewModels.StockInViewModels.StockInListDto
@{
    ViewData["Title"] = "تفاصيل إذن الاستلام";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    :root {
        --primary-solid: #1e293b;
        --secondary-solid: #64748b;
        --accent-solid: #3b82f6;
        --bg-soft: #f8fafc;
        --border-soft: #e2e8f0;
    }

    .card-elegant {
        border: 1px solid var(--border-soft);
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        background: #fff;
    }

    .details-header-elegant {
        background-color: var(--primary-solid);
        color: white;
        padding: 30px 40px;
        border-radius: 12px 12px 0 0;
    }

    .info-label { color: var(--secondary-solid); font-size: 0.85rem; text-transform: uppercase; font-weight: 600; }
    .info-value { color: var(--primary-solid); font-weight: 700; font-size: 1.1rem; }

    .status-badge-lg {
        padding: 8px 20px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.9rem;
    }
    .status-draft { background: #f1f5f9; color: #475569; }
    .status-approved { background: #dcfce7; color: #15803d; }
    .status-received { background: #dbeafe; color: #1e40af; }

    .btn-action-lg {
        padding: 12px 30px;
        border-radius: 50px;
        font-weight: 700;
        transition: all 0.2s;
        border: none;
    }
    .btn-approve { background: #15803d; color: white; }
    .btn-receive { background: #1e40af; color: white; }
</style>

<div class="container-fluid py-4 animate__animated animate__fadeIn">
    <div class="card card-elegant border-0">
        <div class="details-header-elegant d-flex justify-content-between align-items-center">
            <div>
                <h1><i class="fas fa-file-contract me-3"></i> إذن استلام: @Model.DocCode</h1>
                <p class="mb-0 opacity-75">عرض تفاصيل وحالة إذن الاستلام</p>
            </div>
            <div class="d-flex gap-2">
                <a href="@Url.Action("Index")" class="btn btn-outline-light px-4 rounded-pill">العودة للقائمة</a>
                
                @if (Model.Status == "Draft")
                {
                    <form asp-action="Approve" method="post">
                        <input type="hidden" name="id" value="@Model.StockInId" />
                        <button type="submit" class="btn btn-action-lg btn-approve shadow">
                            <i class="fas fa-check-circle me-2"></i> موافقة على الإذن
                        </button>
                    </form>
                }
                @if (Model.Status == "Approved")
                {
                    <form asp-action="Receive" method="post">
                        <input type="hidden" name="id" value="@Model.StockInId" />
                        <button type="submit" class="btn btn-action-lg btn-receive shadow">
                            <i class="fas fa-box-open me-2"></i> تأكيد الاستلام الفعلي
                        </button>
                    </form>
                }
            </div>
        </div>

        <div class="card-body p-5">
            <div class="row g-5 mb-5">
                <div class="col-md-3">
                    <div class="info-label">المورد</div>
                    <div class="info-value">@Model.SupplierName</div>
                </div>
                <div class="col-md-3">
                    <div class="info-label">الفرع</div>
                    <div class="info-value">@Model.BranchName</div>
                </div>
                <div class="col-md-3">
                    <div class="info-label">التاريخ</div>
                    <div class="info-value">@Model.DocDate.ToShortDateString()</div>
                </div>
                <div class="col-md-3">
                    <div class="info-label">الحالة</div>
                    <div>
                        <span class="status-badge-lg status-@(Model.Status.ToLower())">@Model.Status</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="info-label">أمر الشراء</div>
                    <div class="info-value">@(Model.PurchaseOrderCode ?? "---")</div>
                </div>
                <div class="col-md-3">
                    <div class="info-label">رقم الفاتورة</div>
                    <div class="info-value">@(Model.InvoiceNo ?? "---")</div>
                </div>
                <div class="col-md-3">
                    <div class="info-label">إجمالي القيمة</div>
                    <div class="info-value text-primary">@Model.TotalValue.ToString("N2")</div>
                </div>
            </div>

            <h5 class="fw-bold mb-4"><i class="fas fa-list me-2"></i> قائمة الأصناف</h5>
            <div id="detailsGrid" class="grid-container-elegant shadow-sm"></div>

            @if (!string.IsNullOrEmpty(Model.Remarks))
            {
                <div class="mt-5 p-4 bg-light rounded-3">
                    <div class="info-label mb-2">ملاحظات</div>
                    <p class="mb-0">@Model.Remarks</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(function() {
            // In a real scenario, we'd fetch details from an API
            // For now, the service method returns a list including details (TODO: refine)
            // But usually we'd have a StockInResponseDto with details list.
            
            // Assuming we might need an AJAX call if the model doesn't have details
            // For now, let's just show a placeholders or if we can get it from the model
            
            // Since StockInListDto doesn't have details, we might need to modify it or fetch
            // Let's assume for this elegant view we want the details.
            
            // I'll leave the grid setup ready
            $("#detailsGrid").dxDataGrid({
                dataSource: [], // This would be populated from Model.StockInDetails if it existed
                rtlEnabled: true,
                columns: [
                    { dataField: "itemName", caption: "الصنف" },
                    { dataField: "qty", caption: "الكمية", width: 120 },
                    { dataField: "price", caption: "السعر", width: 120, format: "N2" },
                    { dataField: "totalValue", caption: "الإجمالي", width: 150, format: "N2", cssClass: "fw-bold" },
                    { dataField: "expiryDate", caption: "الصلاحية", width: 120, dataType: "date" }
                ]
            });
        });
    </script>
}
